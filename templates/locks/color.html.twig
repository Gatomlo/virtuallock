{% extends 'base.html.twig' %}

{% block title %}VirtualLock{% endblock %}

{% block body %}
<div id="body">
  <div class="container">
    <div class="card passCard" >
    {% if lock.intro is not empty %}
    <div class="card-header passCardHeader">
        {{lock.intro | raw}}
    </div>
    {% endif %}
    <div class="card-body passCardBody">
    <div id="passZone">
      Entrer code
    </div>
    <div id="digit" class="container">
        <div class="row justify-content-center">
          <div class="col oneDigit justify-content-center ">
            <button id="violetDigit" data-color="violet" type="button" class="btn digit btn-primary align-self-center colorButton">
              <svg width="em" height="1em" viewBox="0 0 16 16" class="bi bi-circle-fill" fill="violet" xmlns="http://www.w3.org/2000/svg">
                <circle cx="8" cy="8" r="8"/>
              </svg>
            </button>
          </div>
          <div class="col oneDigit">
            <button id="blueDigit" data-color="blue" type="button" class="btn digit btn-primary align-self-center colorButton">
              <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-circle-fill" fill="blue" xmlns="http://www.w3.org/2000/svg">
                <circle cx="8" cy="8" r="8"/>
              </svg>
            </button>
          </div>
          <div class="col oneDigit">
            <button id="greenDigit" data-color="green" type="button" class="btn digit btn-primary colorButton">
              <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-circle-fill" fill="lightgreen" xmlns="http://www.w3.org/2000/svg">
                <circle cx="8" cy="8" r="8"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="row justify-content-center">
          <div class="col oneDigit">
            <button id="yellowDigit" data-color="yellow" type="button" class="btn digit btn-primary colorButton">
              <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-circle-fill" fill="yellow" xmlns="http://www.w3.org/2000/svg">
                <circle cx="8" cy="8" r="8"/>
              </svg>
            </button>
          </div>
          <div class="col oneDigit">
            <button id="orangeDigit" data-color="orange" type="button" class="btn digit btn-primary colorButton">
              <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-circle-fill" fill="orange" xmlns="http://www.w3.org/2000/svg">
                <circle cx="8" cy="8" r="8"/>
              </svg>
            </button>
          </div>
          <div class="col oneDigit">
            <button id="redDigit" data-color="red" type="button" class="btn digit btn-primary colorButton">
              <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-circle-fill" fill="red" xmlns="http://www.w3.org/2000/svg">
                <circle cx="8" cy="8" r="8"/>
              </svg>
            </button>
          </div>
        </div>

        <div class="row justify-content-center">
          <div class="col oneDigit">
            <button button id="reset" type="button" class="btn digit btn-primary">
              <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-bootstrap-reboot" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M1.161 8a6.84 6.84 0 1 0 6.842-6.84.58.58 0 0 1 0-1.16 8 8 0 1 1-6.556 3.412l-.663-.577a.58.58 0 0 1 .227-.997l2.52-.69a.58.58 0 0 1 .728.633l-.332 2.592a.58.58 0 0 1-.956.364l-.643-.56A6.812 6.812 0 0 0 1.16 8zm5.48-.079V5.277h1.57c.881 0 1.416.499 1.416 1.32 0 .84-.504 1.324-1.386 1.324h-1.6zm0 3.75V8.843h1.57l1.498 2.828h1.314L9.377 8.665c.897-.3 1.427-1.106 1.427-2.1 0-1.37-.943-2.246-2.456-2.246H5.5v7.352h1.141z"/>
              </svg>
            </button>
          </div>
          <div class="col oneDigit">
            <button id="blackDigit" data-color="black" type="button" class="btn digit btn-primary colorButton">
              <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-circle-fill" fill="black" xmlns="http://www.w3.org/2000/svg">
                <circle cx="8" cy="8" r="8"/>
              </svg>
            </button>
          </div>
          <div class="col oneDigit">
            <button id="send" type="button" class="btn digit btn-primary">
              <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-key-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M3.5 11.5a3.5 3.5 0 1 1 3.163-5H14L15.5 8 14 9.5l-1-1-1 1-1-1-1 1-1-1-1 1H6.663a3.5 3.5 0 0 1-3.163 2zM2.5 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
              </svg>
            </button>
          </div>
        </div>
        </div>
        <div id="soluceZone"></div>
    </div>
    </div>
    <table id="zoneCopyright" style="height: 50px;">
      <tbody>
        <tr>
          <td class="align-middle">Â©</td>
          <td class="align-middle"><img id="copyrightLogo" class="img-fluid  mx-auto d-block" alt="logo" src="{{ asset('logos/logo-virtualLock_logo-color.png') }}"></img></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
{% block javascripts %}
<script>
  var solution = '{{lock.solution}}';
  var solutionInArray = solution.split(",");
  var trying =[];
  $('.colorButton').click(function(){
    var color = $(this).data('color');
    trying.push(color);
    $("#passZone").html("");
    displayColors();
  });
  function displayColors(){
    $('#passZone').html("");
    $.each(trying, function(index,color){
      $("#passZone").append('<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-circle-fill" fill="'+color+'" xmlns="http://www.w3.org/2000/svg"><circle cx="8" cy="8" r="8"/></svg>');
    });
  }
  $('#reset').click(function() {
    $("#passZone").html("Entrer code");
    trying = [];
  })
  $('#send').click(function(){
    send();
  })

  function send(){
    $("#message").alert('close');
    var password = trying.toString();
    var url = "{{ path('testSoluce',{ 'id': lock.id, 'userSoluce':'password'})}}";
    url = url.replace('password',password);
    $.ajax({
      url : url,
      cache: false,
      dataType:'html',
      success:function(data){window.location.href = url},
      error:function(){
        $('#soluceZone').append('<div id="message" class="alert alert-danger alert-dismissible fade show" role="alert">'+
        '<strong>Erreur!</strong> Mot de passe incorrect.'+
        '<button type="button" class="close" data-dismiss="alert" aria-label="Close">'+
          '<span aria-hidden="true">&times;</span></button></div>')
        },
      crossDomain:true
    })
  }
</script>
{% endblock %}
